{% extends 'base.html' %}
{% block head %}
    <title>{{ post.title }} | Blog | Antlers</title>
    <meta name="description" content="{{ post.content|striptags|truncate(150) }}">
    <meta property="og:title" content="{{ post.title }} | Blog | Antlers">
    <meta property="og:description" content="{{ post.content|striptags|truncate(150) }}">
    <meta property="og:image" content="{{ url_for('static', filename=post.image_url) }}">
    <meta property="og:url" content="{{ request.url }}">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ post.title }} | Blog | Antlers">
    <meta name="twitter:description" content="{{ post.content|striptags|truncate(150) }}">
    <meta name="twitter:image" content="{{ url_for('static', filename=post.image_url) }}">
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "headline": "{{ post.title|e }}",
      "image": "{{ url_for('static', filename=post.image_url, _external=True) }}",
      "author": {
        "@type": "Person",
        "name": "{{ post.author|e }}"
      },
      "datePublished": "{{ post.created_at.isoformat() }}",
      "dateModified": "{{ post.updated_at.isoformat() }}",
      "description": "{{ post.content|striptags|truncate(150) }}",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "{{ request.url }}"
      }
    }
    </script>
{% endblock %}

{% block content %}
<main class="container py-5">
    <div class="row">
        <div class="col-lg-8">
            <article class="card border-0 shadow-lg mb-4">
                <img src="{{ url_for('static', filename=post.image_url) }}" class="card-img-top" alt="{{ post.title }}" style="max-height: 350px; object-fit: cover;">
                <div class="card-body">
                    <header class="mb-4">
                        <h1 class="card-title display-5 fw-bold">{{ post.title }}</h1>
                        <div class="mb-2 text-muted small">By {{ post.author }} | {{ post.created_at.strftime('%b %d, %Y') }}
                            {% if post.ai_generated %}<span class="badge bg-info text-dark ms-2">AI</span>{% endif %}
                        </div>
                        <div class="mb-3">
                            {% for tag in post.tags.split(',') %}
                                <span class="badge bg-secondary me-1">{{ tag.strip() }}</span>
                            {% endfor %}
                        </div>
                    </header>
                    <section class="blog-content mb-4">
                        {{ post.content|safe }}
                    </section>
                    {% if post.links %}
                    <div class="mt-4">
                        <h5>References</h5>
                        <ul>
                        {% for link in post.links %}
                            <li><a href="{{ link }}" target="_blank" rel="noopener">{{ link }}</a></li>
                        {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
            </article>
        </div>
        <aside class="col-lg-4">
            <div class="mb-4">
                <h5>Categories</h5>
                <ul class="list-unstyled">
                    {% for cat in categories if cat.strip() %}
                    <li><span class="badge bg-light text-dark">{{ cat.strip() }}</span></li>
                    {% endfor %}
                </ul>
            </div>
            <div class="mb-4">
                <h5>Recent Posts</h5>
                <ul class="list-unstyled">
                    {% for recent in recent_posts %}
                    <li><a href="{{ url_for('blog_post', slug=recent.slug) }}" class="text-decoration-none">{{ recent.title }}</a></li>
                    {% endfor %}
                </ul>
            </div>
        </aside>
    </div>
</main>
{% endblock %} 